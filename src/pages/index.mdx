import { useEffect, useState } from 'react';
import { Link, graphql } from 'gatsby'

import Layout from '../components/layout'
import Toolbar from '../components/Toolbar'
import FilmItem from '../components/FilmItem'
import Image from '../components/image'
import SEO from '../components/seo'
import PageLoader from '../components/PageLoader';
import { FilmsWrapper } from './../components/styled';

export const query = graphql`
	query allFilmsQuery {
		allFilmsJson {
			edges {
				node {
					movieId
					movieName
					movieYear
					moviePoster
					movieRating
					movieDescription
					dayWatched
					dateWatched
				}
			}
		}
	}
`

export default function Index ({ data: { allFilmsJson: { edges: filmEdges }} }) {
	// console.log(filmEdges);
	const [loading, setLoading] = useState(true);
	useEffect(() => {
		const config = window.localStorage.getItem("config");
		let loadTime = 3000;
		if(config) {
			const parsedConfig = JSON.parse(config);
			if(parsedConfig.loaded) {
				loadTime = 300;
			}
		}
		setTimeout(() => {
			setLoading(false);
		}, loadTime);
		window.localStorage.setItem("config", JSON.stringify({
			loaded: true
		}));
	}, []);
	return loading ?
	(
		<PageLoader />
	) :
	(
		<Layout>
			<SEO title="Home" keywords={['gatsby', 'application', 'react']} />
			<Toolbar />
			<FilmsWrapper>
				{ filmEdges.map(filmNode => 
					<FilmItem 
						key={filmNode["node"].movieId}
						movieId={filmNode["node"].movieId}
						moviePoster={filmNode["node"].moviePoster}
						movieName={filmNode["node"].movieName}
						movieYear={filmNode["node"].movieYear}
						movieRating={filmNode["node"].movieRating}
						dayWatched={filmNode["node"].dayWatched}
						dateWatched={filmNode["node"].dateWatched}
						movieDescription={filmNode["node"].movieDescription}
					/>)
				}
			</FilmsWrapper>
		</Layout>
	)
}